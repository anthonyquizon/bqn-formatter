#!/usr/bin/env bqn

câ†â€¢FLines "test.bqn"
[a,b]â†â‰>2âŠ¸â†‘Â¨câŠ”ËœÂ¨1âŒŠ+`Â¨('#'=c)âˆ§Â¬â‰ `âŠ¸>Â¨'"'=c  # separate code (a) and comments (b). Avoid # characters in strings
mâ†{Â¬âˆ§Â´' 'âŠ¸=ğ•©}Â¨a                           # remove tail whitespace from code
aâ†©{âŒ½(âˆ¨`' 'âŠ¸â‰ )âŠ¸/âŒ½ğ•©}Â¨âŒ¾(mâŠ¸/)a
sâ†' 'Â¨Â¨â†•Â¨(mâˆ§(0â‰ â‰ Â¨b)âˆ§0â‰ â‰ Â¨a)Ã—1+(âŒˆÂ´â‰ Â¨a)-â‰ Â¨a  # calculate comment prefix whitespace 
â€¢Out 1â†“âˆ¾âˆ¾(@+10)âŠ¸âˆ¾Â¨<Ë˜â‰[a,sâˆ¾Â¨b]             # prepend whitespace and recombine code and comments
